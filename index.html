<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>3Dåœ°çƒå„€æ‡‰ç”¨ç¨‹å¼</title>
    <style>
      body {
        margin: 0;
        padding: 0;
        overflow: hidden;
        font-family: Arial, sans-serif;
        background: #000;
      }

      #globeViz {
        width: 100vw;
        height: 100vh;
      }

      .controls {
        position: absolute;
        top: 20px;
        left: 20px;
        background: rgba(255, 255, 255, 0.9);
        padding: 15px;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        z-index: 1000;
        max-width: 250px;
      }

      .controls h3 {
        margin: 0 0 10px 0;
        font-size: 16px;
        color: #333;
      }

      .controls button {
        margin: 5px;
        padding: 8px 15px;
        background: #4caf50;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 14px;
        transition: background 0.3s;
      }

      .controls button:hover {
        background: #45a049;
      }

      .controls button:active {
        transform: scale(0.95);
      }

      .info {
        position: absolute;
        bottom: 20px;
        left: 20px;
        background: rgba(255, 255, 255, 0.9);
        padding: 10px 15px;
        border-radius: 5px;
        color: #333;
        font-size: 12px;
      }

      .zoom-controls {
        margin-top: 10px;
        padding-top: 10px;
        border-top: 1px solid #ddd;
      }

      .country-info {
        position: absolute;
        top: 20px;
        right: 20px;
        background: rgba(255, 255, 255, 0.95);
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        z-index: 1000;
        min-width: 250px;
        max-width: 350px;
        display: none;
      }

      .country-info.active {
        display: block;
      }

      .country-info h2 {
        margin: 0 0 10px 0;
        color: #333;
        font-size: 20px;
        border-bottom: 2px solid #4caf50;
        padding-bottom: 8px;
      }

      .country-info .detail {
        margin: 8px 0;
        color: #555;
        font-size: 14px;
      }

      .country-info .label {
        font-weight: bold;
        color: #333;
        margin-right: 5px;
      }

      .country-info .close-btn {
        position: absolute;
        top: 10px;
        right: 10px;
        background: #f44336;
        color: white;
        border: none;
        border-radius: 50%;
        width: 25px;
        height: 25px;
        cursor: pointer;
        font-size: 16px;
        line-height: 25px;
        padding: 0;
      }

      .country-info .close-btn:hover {
        background: #d32f2f;
      }

      .audio-controls {
        margin-top: 10px;
        padding-top: 10px;
        border-top: 1px solid #ddd;
      }

      .audio-controls button {
        background: #2196f3;
        margin: 5px 5px 0 0;
      }

      .audio-controls button:hover {
        background: #1976d2;
      }

      #loading {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(255, 255, 255, 0.9);
        padding: 20px 40px;
        border-radius: 10px;
        font-size: 18px;
        color: #333;
        z-index: 2000;
      }
    </style>
  </head>
  <body>
    <div id="loading">è¼‰å…¥ä¸­...</div>
    <div id="globeViz"></div>

    <div class="controls">
      <h3>ğŸŒ åœ°çƒå„€æ§åˆ¶</h3>
      <div>
        <button onclick="autoRotate()">ğŸ”„ è‡ªå‹•æ—‹è½‰</button>
        <button onclick="stopRotation()">â¸ï¸ åœæ­¢æ—‹è½‰</button>
        <button onclick="resetView()">ğŸ  é‡ç½®è¦–è§’</button>
      </div>
      <div class="zoom-controls">
        <button onclick="zoomIn()">ğŸ” æ”¾å¤§</button>
        <button onclick="zoomOut()">ğŸ” ç¸®å°</button>
      </div>
    </div>

    <div class="country-info" id="countryInfo">
      <button class="close-btn" onclick="closeCountryInfo()">Ã—</button>
      <h2 id="countryName">åœ‹å®¶åç¨±</h2>
      <div class="detail">
        <span class="label">é¦–éƒ½ï¼š</span>
        <span id="capitalName">-</span>
      </div>
      <div class="detail">
        <span class="label">è‹±æ–‡åç¨±ï¼š</span>
        <span id="countryNameEn">-</span>
      </div>
      <div class="audio-controls">
        <button onclick="playAnthem()">ğŸµ æ’­æ”¾åœ‹æ­Œï¼ˆ5ç§’ï¼‰</button>
        <button onclick="stopAnthem()">â¹ï¸ åœæ­¢</button>
        <button onclick="openWikipedia()">ğŸ“– æŸ¥çœ‹ç¶­åŸºç™¾ç§‘</button>
        <div style="font-size: 11px; color: #666; margin-top: 8px">
          ğŸ’¡ é»æ“Šç¶­åŸºç™¾ç§‘æŒ‰éˆ•å¯æŸ¥çœ‹å®Œæ•´åœ‹æ­Œ
        </div>
      </div>
    </div>

    <div class="info">ğŸ’¡ æç¤ºï¼šé»æ“Šåœ‹å®¶æŸ¥çœ‹è³‡è¨Šä¸¦æ’­æ”¾åœ‹æ­Œ</div>

    <!-- è¼‰å…¥ Globe.gl å’Œ Three.js åº« -->
    <script src="//unpkg.com/three"></script>
    <script src="//unpkg.com/globe.gl"></script>

    <!-- Audio element for anthem -->
    <audio
      id="anthemPlayer"
      preload="auto"
      crossorigin="anonymous"
      style="display: none"
    ></audio>

    <script>
      // ä¸–ç•Œä¸»è¦100å€‹åœ‹å®¶æ•¸æ“šï¼ˆç¹é«”ä¸­æ–‡ï¼‰
      const countriesData = [
        {
          code: "CN",
          name: "ä¸­åœ‹",
          nameEn: "China",
          capital: "åŒ—äº¬",
          lat: 39.9042,
          lng: 116.4074,
        },
        {
          code: "IN",
          name: "å°åº¦",
          nameEn: "India",
          capital: "æ–°å¾·é‡Œ",
          lat: 28.6139,
          lng: 77.209,
        },
        {
          code: "US",
          name: "ç¾åœ‹",
          nameEn: "United States",
          capital: "è¯ç››é “",
          lat: 38.9072,
          lng: -77.0369,
        },
        {
          code: "ID",
          name: "å°å°¼",
          nameEn: "Indonesia",
          capital: "é›…åŠ é”",
          lat: -6.2088,
          lng: 106.8456,
        },
        {
          code: "PK",
          name: "å·´åŸºæ–¯å¦",
          nameEn: "Pakistan",
          capital: "ä¼Šæ–¯è˜­å ¡",
          lat: 33.6844,
          lng: 73.0479,
        },
        {
          code: "BR",
          name: "å·´è¥¿",
          nameEn: "Brazil",
          capital: "å·´è¥¿åˆ©äº",
          lat: -15.8267,
          lng: -47.9218,
        },
        {
          code: "NG",
          name: "å¥ˆåŠåˆ©äº",
          nameEn: "Nigeria",
          capital: "é˜¿å¸ƒè³ˆ",
          lat: 9.0765,
          lng: 7.3986,
        },
        {
          code: "BD",
          name: "å­ŸåŠ æ‹‰",
          nameEn: "Bangladesh",
          capital: "é”å¡",
          lat: 23.8103,
          lng: 90.4125,
        },
        {
          code: "RU",
          name: "ä¿„ç¾…æ–¯",
          nameEn: "Russia",
          capital: "è«æ–¯ç§‘",
          lat: 55.7558,
          lng: 37.6173,
        },
        {
          code: "MX",
          name: "å¢¨è¥¿å“¥",
          nameEn: "Mexico",
          capital: "å¢¨è¥¿å“¥åŸ",
          lat: 19.4326,
          lng: -99.1332,
        },
        {
          code: "JP",
          name: "æ—¥æœ¬",
          nameEn: "Japan",
          capital: "æ±äº¬",
          lat: 35.6762,
          lng: 139.6503,
        },
        {
          code: "ET",
          name: "è¡£ç´¢æ¯”äº",
          nameEn: "Ethiopia",
          capital: "é˜¿è¿ªæ–¯é˜¿è²å·´",
          lat: 9.032,
          lng: 38.7469,
        },
        {
          code: "PH",
          name: "è²å¾‹è³“",
          nameEn: "Philippines",
          capital: "é¦¬å°¼æ‹‰",
          lat: 14.5995,
          lng: 120.9842,
        },
        {
          code: "EG",
          name: "åŸƒåŠ",
          nameEn: "Egypt",
          capital: "é–‹ç¾…",
          lat: 30.0444,
          lng: 31.2357,
        },
        {
          code: "VN",
          name: "è¶Šå—",
          nameEn: "Vietnam",
          capital: "æ²³å…§",
          lat: 21.0285,
          lng: 105.8542,
        },
        {
          code: "CD",
          name: "å‰›æœæ°‘ä¸»å…±å’Œåœ‹",
          nameEn: "DR Congo",
          capital: "é‡‘å¤æ²™",
          lat: -4.4419,
          lng: 15.2663,
        },
        {
          code: "TR",
          name: "åœŸè€³å…¶",
          nameEn: "Turkey",
          capital: "å®‰å¡æ‹‰",
          lat: 39.9334,
          lng: 32.8597,
        },
        {
          code: "IR",
          name: "ä¼Šæœ—",
          nameEn: "Iran",
          capital: "å¾·é»‘è˜­",
          lat: 35.6892,
          lng: 51.389,
        },
        {
          code: "DE",
          name: "å¾·åœ‹",
          nameEn: "Germany",
          capital: "æŸæ—",
          lat: 52.52,
          lng: 13.405,
        },
        {
          code: "TH",
          name: "æ³°åœ‹",
          nameEn: "Thailand",
          capital: "æ›¼è°·",
          lat: 13.7563,
          lng: 100.5018,
        },
        {
          code: "GB",
          name: "è‹±åœ‹",
          nameEn: "United Kingdom",
          capital: "å€«æ•¦",
          lat: 51.5074,
          lng: -0.1278,
        },
        {
          code: "FR",
          name: "æ³•åœ‹",
          nameEn: "France",
          capital: "å·´é»",
          lat: 48.8566,
          lng: 2.3522,
        },
        {
          code: "IT",
          name: "ç¾©å¤§åˆ©",
          nameEn: "Italy",
          capital: "ç¾…é¦¬",
          lat: 41.9028,
          lng: 12.4964,
        },
        {
          code: "TZ",
          name: "å¦å°šå°¼äº",
          nameEn: "Tanzania",
          capital: "å¤šå¤šé¦¬",
          lat: -6.163,
          lng: 35.7516,
        },
        {
          code: "ZA",
          name: "å—é",
          nameEn: "South Africa",
          capital: "æ™®åˆ©æ‰˜åˆ©äº",
          lat: -25.7479,
          lng: 28.2293,
        },
        {
          code: "MM",
          name: "ç·¬ç”¸",
          nameEn: "Myanmar",
          capital: "å¥ˆæ¯”å¤š",
          lat: 19.7633,
          lng: 96.0785,
        },
        {
          code: "KR",
          name: "éŸ“åœ‹",
          nameEn: "South Korea",
          capital: "é¦–çˆ¾",
          lat: 37.5665,
          lng: 126.978,
        },
        {
          code: "CO",
          name: "å“¥å€«æ¯”äº",
          nameEn: "Colombia",
          capital: "æ³¢å“¥å¤§",
          lat: 4.711,
          lng: -74.0721,
        },
        {
          code: "ES",
          name: "è¥¿ç­ç‰™",
          nameEn: "Spain",
          capital: "é¦¬å¾·é‡Œ",
          lat: 40.4168,
          lng: -3.7038,
        },
        {
          code: "AR",
          name: "é˜¿æ ¹å»·",
          nameEn: "Argentina",
          capital: "å¸ƒå®œè«¾æ–¯è‰¾åˆ©æ–¯",
          lat: -34.6037,
          lng: -58.3816,
        },
        {
          code: "DZ",
          name: "é˜¿çˆ¾åŠåˆ©äº",
          nameEn: "Algeria",
          capital: "é˜¿çˆ¾åŠçˆ¾",
          lat: 36.7538,
          lng: 3.0588,
        },
        {
          code: "SD",
          name: "è˜‡ä¸¹",
          nameEn: "Sudan",
          capital: "å–€åœŸç©†",
          lat: 15.5007,
          lng: 32.5599,
        },
        {
          code: "UA",
          name: "çƒå…‹è˜­",
          nameEn: "Ukraine",
          capital: "åŸºè¼”",
          lat: 50.4501,
          lng: 30.5234,
        },
        {
          code: "UG",
          name: "çƒå¹²é”",
          nameEn: "Uganda",
          capital: "åå¸•æ‹‰",
          lat: 0.3476,
          lng: 32.5825,
        },
        {
          code: "IQ",
          name: "ä¼Šæ‹‰å…‹",
          nameEn: "Iraq",
          capital: "å·´æ ¼é”",
          lat: 33.3152,
          lng: 44.3661,
        },
        {
          code: "PL",
          name: "æ³¢è˜­",
          nameEn: "Poland",
          capital: "è¯æ²™",
          lat: 52.2297,
          lng: 21.0122,
        },
        {
          code: "CA",
          name: "åŠ æ‹¿å¤§",
          nameEn: "Canada",
          capital: "æ¸¥å¤ªè¯",
          lat: 45.4215,
          lng: -75.6972,
        },
        {
          code: "MA",
          name: "æ‘©æ´›å“¥",
          nameEn: "Morocco",
          capital: "æ‹‰å·´ç‰¹",
          lat: 34.0209,
          lng: -6.8416,
        },
        {
          code: "SA",
          name: "æ²™çƒåœ°é˜¿æ‹‰ä¼¯",
          nameEn: "Saudi Arabia",
          capital: "åˆ©é›…å¾·",
          lat: 24.7136,
          lng: 46.6753,
        },
        {
          code: "UZ",
          name: "çƒèŒ²åˆ¥å…‹",
          nameEn: "Uzbekistan",
          capital: "å¡”ä»€å¹²",
          lat: 41.2995,
          lng: 69.2401,
        },
        {
          code: "PE",
          name: "ç§˜é­¯",
          nameEn: "Peru",
          capital: "åˆ©é¦¬",
          lat: -12.0464,
          lng: -77.0428,
        },
        {
          code: "MY",
          name: "é¦¬ä¾†è¥¿äº",
          nameEn: "Malaysia",
          capital: "å‰éš†å¡",
          lat: 3.139,
          lng: 101.6869,
        },
        {
          code: "AF",
          name: "é˜¿å¯Œæ±—",
          nameEn: "Afghanistan",
          capital: "å–€å¸ƒçˆ¾",
          lat: 34.5553,
          lng: 69.2075,
        },
        {
          code: "VE",
          name: "å§”å…§ç‘æ‹‰",
          nameEn: "Venezuela",
          capital: "å¡æ‹‰å¡æ–¯",
          lat: 10.4806,
          lng: -66.9036,
        },
        {
          code: "NP",
          name: "å°¼æ³Šçˆ¾",
          nameEn: "Nepal",
          capital: "åŠ å¾·æ»¿éƒ½",
          lat: 27.7172,
          lng: 85.324,
        },
        {
          code: "YE",
          name: "è‘‰é–€",
          nameEn: "Yemen",
          capital: "æ²™é‚£",
          lat: 15.5527,
          lng: 48.5164,
        },
        {
          code: "GH",
          name: "è¿¦ç´",
          nameEn: "Ghana",
          capital: "é˜¿å…‹æ‹‰",
          lat: 5.6037,
          lng: -0.187,
        },
        {
          code: "MZ",
          name: "è«ä¸‰æ¯”å…‹",
          nameEn: "Mozambique",
          capital: "é¦¬å¸ƒå¤š",
          lat: -25.9655,
          lng: 32.5832,
        },
        {
          code: "TW",
          name: "å°ç£",
          nameEn: "Taiwan",
          capital: "å°åŒ—",
          lat: 25.033,
          lng: 121.5654,
        },
        {
          code: "AU",
          name: "æ¾³æ´²",
          nameEn: "Australia",
          capital: "ååŸ¹æ‹‰",
          lat: -35.2809,
          lng: 149.13,
        },
        {
          code: "KP",
          name: "åŒ—éŸ“",
          nameEn: "North Korea",
          capital: "å¹³å£¤",
          lat: 39.0392,
          lng: 125.7625,
        },
        {
          code: "CI",
          name: "è±¡ç‰™æµ·å²¸",
          nameEn: "Ivory Coast",
          capital: "é›…ç©†ç´¢æˆˆ",
          lat: 6.827,
          lng: -5.2893,
        },
        {
          code: "CM",
          name: "å–€éº¥éš†",
          nameEn: "Cameroon",
          capital: "é›…æº«å¾—",
          lat: 3.848,
          lng: 11.5021,
        },
        {
          code: "LK",
          name: "æ–¯é‡Œè˜­å¡",
          nameEn: "Sri Lanka",
          capital: "å¯å€«å¡",
          lat: 6.9271,
          lng: 79.8612,
        },
        {
          code: "NL",
          name: "è·è˜­",
          nameEn: "Netherlands",
          capital: "é˜¿å§†æ–¯ç‰¹ä¸¹",
          lat: 52.3676,
          lng: 4.9041,
        },
        {
          code: "CL",
          name: "æ™ºåˆ©",
          nameEn: "Chile",
          capital: "è–åœ°ç‰™å“¥",
          lat: -33.4489,
          lng: -70.6693,
        },
        {
          code: "RO",
          name: "ç¾…é¦¬å°¼äº",
          nameEn: "Romania",
          capital: "å¸ƒåŠ å‹’æ–¯ç‰¹",
          lat: 44.4268,
          lng: 26.1025,
        },
        {
          code: "KZ",
          name: "å“ˆè–©å…‹",
          nameEn: "Kazakhstan",
          capital: "é˜¿æ–¯å¡”ç´",
          lat: 51.1694,
          lng: 71.4491,
        },
        {
          code: "NE",
          name: "å°¼æ—¥",
          nameEn: "Niger",
          capital: "å°¼é˜¿ç¾",
          lat: 13.5127,
          lng: 2.1128,
        },
        {
          code: "BF",
          name: "å¸ƒå‰ç´æ³•ç´¢",
          nameEn: "Burkina Faso",
          capital: "ç“¦åŠ æœå¤",
          lat: 12.3714,
          lng: -1.5197,
        },
        {
          code: "ML",
          name: "é¦¬åˆ©",
          nameEn: "Mali",
          capital: "å·´é¦¬ç§‘",
          lat: 12.6392,
          lng: -8.0029,
        },
        {
          code: "MW",
          name: "é¦¬æ‹‰å¨",
          nameEn: "Malawi",
          capital: "é‡Œæœ—å¨",
          lat: -13.9626,
          lng: 33.7741,
        },
        {
          code: "EC",
          name: "å„ç“œå¤š",
          nameEn: "Ecuador",
          capital: "åŸºå¤š",
          lat: -0.1807,
          lng: -78.4678,
        },
        {
          code: "GT",
          name: "ç“œåœ°é¦¬æ‹‰",
          nameEn: "Guatemala",
          capital: "ç“œåœ°é¦¬æ‹‰åŸ",
          lat: 14.6349,
          lng: -90.5069,
        },
        {
          code: "SY",
          name: "æ•˜åˆ©äº",
          nameEn: "Syria",
          capital: "å¤§é¦¬å£«é©",
          lat: 33.5138,
          lng: 36.2765,
        },
        {
          code: "SN",
          name: "å¡å…§åŠ çˆ¾",
          nameEn: "Senegal",
          capital: "é”å–€çˆ¾",
          lat: 14.6928,
          lng: -17.4467,
        },
        {
          code: "TD",
          name: "æŸ¥å¾·",
          nameEn: "Chad",
          capital: "æ©è³ˆæ¢…ç´",
          lat: 12.1348,
          lng: 15.0557,
        },
        {
          code: "SO",
          name: "ç´¢é¦¬åˆ©äº",
          nameEn: "Somalia",
          capital: "æ‘©åŠ è¿ªä¼‘",
          lat: 2.0469,
          lng: 45.3182,
        },
        {
          code: "ZM",
          name: "å°šæ¯”äº",
          nameEn: "Zambia",
          capital: "è·¯æ²™å¡",
          lat: -15.3875,
          lng: 28.3228,
        },
        {
          code: "ZW",
          name: "è¾›å·´å¨",
          nameEn: "Zimbabwe",
          capital: "å“ˆæ‹‰é›·",
          lat: -17.8252,
          lng: 31.0335,
        },
        {
          code: "RW",
          name: "ç›§å®‰é”",
          nameEn: "Rwanda",
          capital: "å‰ä½³åˆ©",
          lat: -1.9403,
          lng: 30.0619,
        },
        {
          code: "GN",
          name: "å¹¾å…§äº",
          nameEn: "Guinea",
          capital: "ç§‘ç´å…‹é‡Œ",
          lat: 9.6412,
          lng: -13.5784,
        },
        {
          code: "TN",
          name: "çªå°¼è¥¿äº",
          nameEn: "Tunisia",
          capital: "çªå°¼æ–¯",
          lat: 36.8065,
          lng: 10.1815,
        },
        {
          code: "BE",
          name: "æ¯”åˆ©æ™‚",
          nameEn: "Belgium",
          capital: "å¸ƒé­¯å¡çˆ¾",
          lat: 50.8503,
          lng: 4.3517,
        },
        {
          code: "BO",
          name: "ç»åˆ©ç¶­äº",
          nameEn: "Bolivia",
          capital: "æ‹‰å·´æ–¯",
          lat: -16.5,
          lng: -68.15,
        },
        {
          code: "CU",
          name: "å¤å·´",
          nameEn: "Cuba",
          capital: "å“ˆç“¦é‚£",
          lat: 23.1136,
          lng: -82.3666,
        },
        {
          code: "GR",
          name: "å¸Œè‡˜",
          nameEn: "Greece",
          capital: "é›…å…¸",
          lat: 37.9838,
          lng: 23.7275,
        },
        {
          code: "CZ",
          name: "æ·å…‹",
          nameEn: "Czech Republic",
          capital: "å¸ƒæ‹‰æ ¼",
          lat: 50.0755,
          lng: 14.4378,
        },
        {
          code: "PT",
          name: "è‘¡è„ç‰™",
          nameEn: "Portugal",
          capital: "é‡Œæ–¯æœ¬",
          lat: 38.7223,
          lng: -9.1393,
        },
        {
          code: "JO",
          name: "ç´„æ—¦",
          nameEn: "Jordan",
          capital: "å®‰æ›¼",
          lat: 31.9454,
          lng: 35.9284,
        },
        {
          code: "AZ",
          name: "äºå¡æ‹œç„¶",
          nameEn: "Azerbaijan",
          capital: "å·´åº«",
          lat: 40.4093,
          lng: 49.8671,
        },
        {
          code: "SE",
          name: "ç‘å…¸",
          nameEn: "Sweden",
          capital: "æ–¯å¾·å“¥çˆ¾æ‘©",
          lat: 59.3293,
          lng: 18.0686,
        },
        {
          code: "HU",
          name: "åŒˆç‰™åˆ©",
          nameEn: "Hungary",
          capital: "å¸ƒé”ä½©æ–¯",
          lat: 47.4979,
          lng: 19.0402,
        },
        {
          code: "BY",
          name: "ç™½ä¿„ç¾…æ–¯",
          nameEn: "Belarus",
          capital: "æ˜æ–¯å…‹",
          lat: 53.9006,
          lng: 27.559,
        },
        {
          code: "AE",
          name: "é˜¿æ‹‰ä¼¯è¯åˆå¤§å…¬åœ‹",
          nameEn: "UAE",
          capital: "é˜¿å¸ƒé”æ¯”",
          lat: 24.4539,
          lng: 54.3773,
        },
        {
          code: "IL",
          name: "ä»¥è‰²åˆ—",
          nameEn: "Israel",
          capital: "è€¶è·¯æ’’å†·",
          lat: 31.7683,
          lng: 35.2137,
        },
        {
          code: "HK",
          name: "é¦™æ¸¯",
          nameEn: "Hong Kong",
          capital: "é¦™æ¸¯",
          lat: 22.3193,
          lng: 114.1694,
        },
        {
          code: "AT",
          name: "å¥§åœ°åˆ©",
          nameEn: "Austria",
          capital: "ç¶­ä¹Ÿç´",
          lat: 48.2082,
          lng: 16.3738,
        },
        {
          code: "CH",
          name: "ç‘å£«",
          nameEn: "Switzerland",
          capital: "ä¼¯æ©",
          lat: 46.948,
          lng: 7.4474,
        },
        {
          code: "TJ",
          name: "å¡”å‰å…‹",
          nameEn: "Tajikistan",
          capital: "æœå°šåˆ¥",
          lat: 38.5598,
          lng: 68.7738,
        },
        {
          code: "HN",
          name: "å®éƒ½æ‹‰æ–¯",
          nameEn: "Honduras",
          capital: "å¾·å¤è¥¿åŠ å·´",
          lat: 14.0723,
          lng: -87.1921,
        },
        {
          code: "DO",
          name: "å¤šæ˜å°¼åŠ ",
          nameEn: "Dominican Republic",
          capital: "è–å¤šæ˜å“¥",
          lat: 18.4861,
          lng: -69.9312,
        },
        {
          code: "DK",
          name: "ä¸¹éº¥",
          nameEn: "Denmark",
          capital: "å“¥æœ¬å“ˆæ ¹",
          lat: 55.6761,
          lng: 12.5683,
        },
        {
          code: "FI",
          name: "èŠ¬è˜­",
          nameEn: "Finland",
          capital: "èµ«çˆ¾è¾›åŸº",
          lat: 60.1695,
          lng: 24.9354,
        },
        {
          code: "NO",
          name: "æŒªå¨",
          nameEn: "Norway",
          capital: "å¥§æ–¯é™¸",
          lat: 59.9139,
          lng: 10.7522,
        },
        {
          code: "SG",
          name: "æ–°åŠ å¡",
          nameEn: "Singapore",
          capital: "æ–°åŠ å¡",
          lat: 1.3521,
          lng: 103.8198,
        },
        {
          code: "NZ",
          name: "ç´è¥¿è˜­",
          nameEn: "New Zealand",
          capital: "å¨éˆé “",
          lat: -41.2865,
          lng: 174.7762,
        },
        {
          code: "IE",
          name: "æ„›çˆ¾è˜­",
          nameEn: "Ireland",
          capital: "éƒ½æŸæ—",
          lat: 53.3498,
          lng: -6.2603,
        },
        {
          code: "KE",
          name: "è‚¯äº",
          nameEn: "Kenya",
          capital: "å¥ˆæ´›æ¯”",
          lat: -1.2864,
          lng: 36.8172,
        },
      ];

      // ç•¶å‰é¸ä¸­çš„åœ‹å®¶
      let selectedCountry = null;
      let world = null;

      // åˆå§‹åŒ–åœ°çƒå„€
      async function initGlobe() {
        world = Globe()(document.getElementById("globeViz"))
          .globeImageUrl(
            "//unpkg.com/three-globe/example/img/earth-blue-marble.jpg"
          )
          .bumpImageUrl(
            "//unpkg.com/three-globe/example/img/earth-topology.png"
          )
          .backgroundImageUrl(
            "//unpkg.com/three-globe/example/img/night-sky.png"
          )
          .showAtmosphere(true)
          .atmosphereColor("lightskyblue")
          .atmosphereAltitude(0.25);

        // è¼‰å…¥åœ‹å®¶é‚Šç•Œæ•¸æ“š
        try {
          const response = await fetch(
            "https://raw.githubusercontent.com/nvkelso/natural-earth-vector/master/geojson/ne_110m_admin_0_countries.geojson"
          );
          const countries = await response.json();

          // æ·»åŠ åœ‹å®¶é‚Šç•Œå¤šé‚Šå½¢
          world
            .polygonsData(
              countries.features.filter((d) => d.properties.ISO_A2 !== "AQ")
            )
            .polygonAltitude(0.01)
            .polygonCapColor(() => "rgba(200, 200, 200, 0.6)")
            .polygonSideColor(() => "rgba(200, 200, 200, 0.3)")
            .polygonStrokeColor(() => "#111")
            .polygonLabel(({ properties: d }) => {
              const countryData = countriesData.find(
                (c) => c.code === d.ISO_A2
              );
              if (countryData) {
                return `<div style="background: rgba(0,0,0,0.8); padding: 10px; border-radius: 5px; color: white;">
                  <b>${countryData.name}</b><br/>
                  é¦–éƒ½: ${countryData.capital}<br/>
                  (${countryData.nameEn})
                </div>`;
              }
              return `<b>${d.ADMIN}</b>`;
            })
            .onPolygonClick((polygon) => {
              if (polygon && polygon.properties) {
                const countryData = countriesData.find(
                  (c) => c.code === polygon.properties.ISO_A2
                );
                if (countryData) {
                  showCountryInfo(countryData);
                }
              }
            })
            .polygonCapMaterial(
              () =>
                new THREE.MeshLambertMaterial({
                  color: "#efefef",
                  side: THREE.DoubleSide,
                  transparent: true,
                  opacity: 0.7,
                })
            );
        } catch (error) {
          console.error("è¼‰å…¥åœ‹å®¶é‚Šç•Œå¤±æ•—:", error);
        }

        // æ·»åŠ é¦–éƒ½æ¨™è¨˜é»
        world
          .pointsData(countriesData)
          .pointLat("lat")
          .pointLng("lng")
          .pointAltitude(0.01)
          .pointColor(() => "#ff4444")
          .pointRadius(0.15)
          .pointLabel(
            (
              d
            ) => `<div style="background: rgba(0,0,0,0.8); padding: 8px; border-radius: 5px; color: white;">
            <b>${d.name}</b><br/>
            é¦–éƒ½: ${d.capital}
          </div>`
          )
          .onPointClick((point) => {
            showCountryInfo(point);
          });

        // è¨­ç½®åˆå§‹è¦–è§’
        world.pointOfView({ lat: 25.033, lng: 121.5654, altitude: 2.5 }, 1000);

        // å•Ÿç”¨æ§åˆ¶å™¨
        world.controls().enableZoom = true;
        world.controls().autoRotate = false;
        world.controls().autoRotateSpeed = 0.5;

        // éŸ¿æ‡‰å¼è¨­è¨ˆ
        window.addEventListener("resize", () => {
          world.width(window.innerWidth);
          world.height(window.innerHeight);
        });

        // éš±è—è¼‰å…¥æç¤º
        document.getElementById("loading").style.display = "none";
      }

      // é¡¯ç¤ºåœ‹å®¶è³‡è¨Š
      function showCountryInfo(country) {
        selectedCountry = country;
        document.getElementById("countryName").textContent = country.name;
        document.getElementById("capitalName").textContent = country.capital;
        document.getElementById("countryNameEn").textContent = country.nameEn;
        document.getElementById("countryInfo").classList.add("active");

        // ç§»å‹•è¦–è§’åˆ°è©²åœ‹å®¶
        world.pointOfView(
          {
            lat: country.lat,
            lng: country.lng,
            altitude: 1.5,
          },
          1000
        );
      }

      // é—œé–‰åœ‹å®¶è³‡è¨Šé¢æ¿
      function closeCountryInfo() {
        document.getElementById("countryInfo").classList.remove("active");
        stopAnthem();
        selectedCountry = null;
      }

      // æ’­æ”¾åœ‹æ­Œ
      async function playAnthem() {
        if (!selectedCountry) return;

        const player = document.getElementById("anthemPlayer");
        
        // æ›´æ–°çš„åœ‹æ­ŒéŸ³æª”é€£çµ - ä½¿ç”¨ç›´æ¥çš„ OGG æª”æ¡ˆ
        const anthemUrls = {
          TW: "https://upload.wikimedia.org/wikipedia/commons/a/a4/National_Anthem_of_the_Republic_of_China.ogg",
          US: "https://upload.wikimedia.org/wikipedia/commons/e/e6/United_States_National_Anthem.ogg",
          JP: "https://upload.wikimedia.org/wikipedia/commons/6/68/Kimi_ga_Yo_instrumental.ogg",
          CN: "https://upload.wikimedia.org/wikipedia/commons/8/88/March_of_the_Volunteers.ogg",
          GB: "https://upload.wikimedia.org/wikipedia/commons/b/b9/God_Save_the_King_instrumental.ogg",
          FR: "https://upload.wikimedia.org/wikipedia/commons/f/fd/La_Marseillaise.ogg",
          DE: "https://upload.wikimedia.org/wikipedia/commons/d/d9/Instrumental_version_of_Deutschlandlied.ogg",
          IT: "https://upload.wikimedia.org/wikipedia/commons/0/00/Inno_di_Mameli_instrumental.ogg",
          ES: "https://upload.wikimedia.org/wikipedia/commons/a/a0/National_Anthem_of_Spain_-_US_Navy_Band.ogg",
          RU: "https://upload.wikimedia.org/wikipedia/commons/f/f3/Anthem_of_Russia_instrumental.ogg",
          BR: "https://upload.wikimedia.org/wikipedia/commons/9/9b/Hino_Nacional_Brasileiro_instrumental.ogg",
          IN: "https://upload.wikimedia.org/wikipedia/commons/9/94/Jana_Gana_Mana_instrumental.ogg",
          KR: "https://upload.wikimedia.org/wikipedia/commons/1/1f/Aegukga_instrumental.ogg",
          CA: "https://upload.wikimedia.org/wikipedia/commons/3/3b/O_Canada_instrumental.ogg",
          AU: "https://upload.wikimedia.org/wikipedia/commons/2/2e/Advance_Australia_Fair_instrumental.ogg",
          MX: "https://upload.wikimedia.org/wikipedia/commons/5/5f/Mexican_National_Anthem_Instrumental.ogg",
        };

        const anthemUrl = anthemUrls[selectedCountry.code];

        if (anthemUrl) {
          try {
            // åœæ­¢ä¹‹å‰çš„æ’­æ”¾
            stopAnthem();
            
            player.src = anthemUrl;
            player.volume = 0.7; // è¨­å®šéŸ³é‡ç‚º 70%
            
            // ç­‰å¾…è¼‰å…¥ä¸¦æ’­æ”¾
            await player.load();
            
            try {
              await player.play();
              console.log(`æ­£åœ¨æ’­æ”¾ ${selectedCountry.name} çš„åœ‹æ­Œ`);
              
              // 5ç§’å¾Œåœæ­¢
              setTimeout(() => {
                stopAnthem();
              }, 5000);
              
            } catch (playError) {
              console.error("æ’­æ”¾å¤±æ•—:", playError);
              // å¦‚æœæ’­æ”¾å¤±æ•—ï¼Œæä¾›ç¶­åŸºç™¾ç§‘é€£çµä½œç‚ºå‚™ç”¨æ–¹æ¡ˆ
              const confirmOpen = confirm(
                `ç„¡æ³•ç›´æ¥æ’­æ”¾åœ‹æ­ŒéŸ³æª”\n\næ˜¯å¦è¦å‰å¾€ç¶­åŸºç™¾ç§‘é é¢è†è½å®Œæ•´ç‰ˆåœ‹æ­Œï¼Ÿ\nï¼ˆé»æ“Šã€Œç¢ºå®šã€å°‡é–‹å•Ÿæ–°åˆ†é ï¼‰`
              );
              if (confirmOpen) {
                openWikipedia();
              }
            }
          } catch (error) {
            console.error("è¼‰å…¥éŸ³æª”å¤±æ•—:", error);
            const confirmOpen = confirm(
              `è¼‰å…¥éŸ³æª”å¤±æ•—\n\næ˜¯å¦è¦å‰å¾€ç¶­åŸºç™¾ç§‘é é¢è†è½å®Œæ•´ç‰ˆåœ‹æ­Œï¼Ÿ\nï¼ˆé»æ“Šã€Œç¢ºå®šã€å°‡é–‹å•Ÿæ–°åˆ†é ï¼‰`
            );
            if (confirmOpen) {
              openWikipedia();
            }
          }
        } else {
          alert(`æŠ±æ­‰ï¼Œæš«æ™‚æ²’æœ‰${selectedCountry.name}çš„åœ‹æ­Œè³‡æº\n\nå»ºè­°é»æ“Šã€ŒæŸ¥çœ‹ç¶­åŸºç™¾ç§‘ã€æŒ‰éˆ•ä»¥ç²å–æ›´å¤šè³‡è¨Š`);
        }
      }
      
      // æ‰“é–‹ç¶­åŸºç™¾ç§‘é é¢
      function openWikipedia() {
        if (!selectedCountry) return;
        
        // ç¶­åŸºç™¾ç§‘ä¸­æ–‡é é¢é€£çµå°æ‡‰
        const wikipediaPages = {
          TW: "https://zh.wikipedia.org/zh-tw/ä¸­è¯æ°‘åœ‹åœ‹æ­Œ",
          US: "https://zh.wikipedia.org/zh-tw/æ˜Ÿæ¢æ——_(ç¾åœ‹åœ‹æ­Œ)",
          JP: "https://zh.wikipedia.org/zh-tw/å›ä¹‹ä»£",
          CN: "https://zh.wikipedia.org/zh-tw/ç¾©å‹‡è»é€²è¡Œæ›²",
          GB: "https://zh.wikipedia.org/zh-tw/å¤©ä½‘åœ‹ç‹",
          FR: "https://zh.wikipedia.org/zh-tw/é¦¬è³½æ›²",
          DE: "https://zh.wikipedia.org/zh-tw/å¾·æ„å¿—ä¹‹æ­Œ",
          IT: "https://zh.wikipedia.org/zh-tw/ç¾©å¤§åˆ©äººä¹‹æ­Œ",
          ES: "https://zh.wikipedia.org/zh-tw/çš‡å®¶é€²è¡Œæ›²",
          RU: "https://zh.wikipedia.org/zh-tw/ä¿„ç¾…æ–¯è¯é‚¦åœ‹æ­Œ",
          BR: "https://zh.wikipedia.org/zh-tw/å·´è¥¿åœ‹æ­Œ",
          IN: "https://zh.wikipedia.org/zh-tw/äººæ°‘çš„æ„å¿—",
          KR: "https://zh.wikipedia.org/zh-tw/æ„›åœ‹æ­Œ",
          CA: "https://zh.wikipedia.org/zh-tw/å•Šï¼ŒåŠ æ‹¿å¤§",
          AU: "https://zh.wikipedia.org/zh-tw/å‰é€²ï¼Œç¾éº—çš„æ¾³å¤§åˆ©äº",
          MX: "https://zh.wikipedia.org/zh-tw/å¢¨è¥¿å“¥åœ‹æ­Œ"
        };
        
        // å¦‚æœæœ‰å°æ‡‰çš„ç¶­åŸºç™¾ç§‘é é¢ï¼Œæ‰“é–‹å®ƒï¼›å¦å‰‡æœå°‹è©²åœ‹å®¶
        const wikiUrl = wikipediaPages[selectedCountry.code] || 
                        `https://zh.wikipedia.org/wiki/${encodeURIComponent(selectedCountry.name)}`;
        
        window.open(wikiUrl, '_blank');
      }

      // åœæ­¢æ’­æ”¾åœ‹æ­Œ
      function stopAnthem() {
        const player = document.getElementById("anthemPlayer");
        player.pause();
        player.currentTime = 0;
      }

      // æ§åˆ¶è®Šé‡
      let rotating = false;
      let rotationInterval;

      // è‡ªå‹•æ—‹è½‰åŠŸèƒ½
      function autoRotate() {
        if (!rotating && world) {
          rotating = true;
          rotationInterval = setInterval(() => {
            const controls = world.controls();
            controls.autoRotate = true;
            controls.autoRotateSpeed = 0.5;
          }, 16);
        }
      }

      // åœæ­¢æ—‹è½‰
      function stopRotation() {
        if (rotating && world) {
          rotating = false;
          clearInterval(rotationInterval);
          const controls = world.controls();
          controls.autoRotate = false;
        }
      }

      // é‡ç½®è¦–è§’
      function resetView() {
        if (world) {
          stopRotation();
          world.pointOfView(
            { lat: 25.033, lng: 121.5654, altitude: 2.5 },
            1000
          );
        }
      }

      // æ”¾å¤§
      function zoomIn() {
        if (world) {
          const pov = world.pointOfView();
          const newAltitude = Math.max(pov.altitude - 0.5, 0.5);
          world.pointOfView(
            {
              lat: pov.lat,
              lng: pov.lng,
              altitude: newAltitude,
            },
            300
          );
        }
      }

      // ç¸®å°
      function zoomOut() {
        if (world) {
          const pov = world.pointOfView();
          const newAltitude = Math.min(pov.altitude + 0.5, 5);
          world.pointOfView(
            {
              lat: pov.lat,
              lng: pov.lng,
              altitude: newAltitude,
            },
            300
          );
        }
      }

      // é é¢è¼‰å…¥å¾Œåˆå§‹åŒ–
      window.addEventListener("load", initGlobe);
    </script>
  </body>
</html>
